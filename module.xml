<?xml version="1.0" ?>
<module>
  <Login f="nodata">
    <Login>
      <Users t="dropdown" f="user nocertainty noannotation"/>
      <Log_in  t="button" l="Control">
        <!--TODO: Change to ll-->
      </Log_in>
      <Sign_up t="button" l="signup"/>
    </Login>
  </Login>
  <Control f="nodata">
    <Control f="noscroll">
      <Record_New_Mound t="button" f="nocertainty noannotation" l="Mound"/>
      <autonum/>
    </Control>
    <search/>
    <Map f="noscroll">
      <Map f="nolabel" t="map"/>
    </Map>
  </Control>
  <Mound>
    <Mound_Admin>
      <author f="id nocertainty noannotation">
        <str>
          <pos>3</pos>
          <fmt>$0</fmt>
        </str>
      </author>
      <timestamp f="nocertainty noannotation"/>
      <Mound_ID f="id nocertainty noannotation autonum readonly">
        <str>
          <pos>1</pos>
          <fmt>$0- </fmt>
        </str>
      </Mound_ID>
      <Mound_Name f="id">
        <str>
          <pos>2</pos>
          <fmt>$0- </fmt>
        </str>
      </Mound_Name>
      <gps f="notnull"/>
      <Description_of_mound_or_location/>
      <Maximum_Height_in_m b="decimal" f="notnull">
        Maximum Height (m)
      </Maximum_Height_in_m>
      <Minimum_Height_in_m b="decimal">
        Minimum Height (m)
      </Minimum_Height_in_m>
      <Length b="decimal" f="notnull">
        Length (m)
        <desc>The longest axis in the diameter</desc>
      </Length>
      <Width b="decimal">
        Width (m)
        <desc>The shorter axis in diameter, if mound ellipsoid</desc>
      </Width>
      <Image t="camera"/>
    </Mound_Admin>
    <Condition>
      <Landuse_around_Mound t="picture" f="notnull">
        <desc>Landuse around the mound. Choose the majority landuse.</desc>
        <opts>
          <opt p="gallery/Around_Landuse/Agr_Seedling_9063_Overview_NW01.JPG">
            Annual agriculture
          </opt>
          <opt p="gallery/Around_Landuse/Perennial_9072_Overview_S01.JPG">
            Perennial agriculture (e.g orchard or vineyard)
          </opt>
          <opt p="gallery/Around_Landuse/Pasture_9138_Overview_S01.JPG">
            Pasture (grassland)
          </opt>
          <opt p="gallery/Around_Landuse/Scrub_9155_Overview_E01.JPG">
            Scrub
          </opt>
          <opt p="gallery/Around_Landuse/Forest_3097_Overview_W_2.JPG">
            Forest
          </opt>
          <opt>
            Urban (in a settlement or surrounded by infrastructure)
          </opt>
          <opt p="gallery/Around_Landuse/Other_3276_Overview01_N.JPG">
            Other (explain in notes)
          </opt>
        </opts>
      </Landuse_around_Mound>
      <Landuse_on_top_of_Mound t="picture" f="notnull">
        <desc>Landuse on top of mound. Choose majority.</desc>
        <opts>
          <opt p="gallery/Top_Landuse/Agr_6015_Overview_N.jpg">
            Annual agriculture
          </opt>
          <opt>
            Perennial agriculture (e.g orchard or vineyard)
          </opt>
          <opt p="gallery/Top_Landuse/Grassland_3315_Overview_S.JPG">
            Pasture (grassland)
          </opt>
          <opt p="gallery/Top_Landuse/Scrub_2099_Overview_W02.JPG">
            Scrub
          </opt>
          <opt p="gallery/Top_Landuse/Forest_3267_Overview_W02.dng">
            Forest
          </opt>
          <opt>
            Urban (in a settlement or surrounded by infrastructure)
          </opt>
          <opt p="gallery/Top_Landuse/Other_3276_Overview01_N.JPG">
            Other (explain in notes)
          </opt>
        </opts>
      </Landuse_on_top_of_Mound>
      <Notes_on_shape_and_dimension/>
      <Condition t="dropdown" f="notnull">
        <desc>What effect has the looting or other damage had on the archaeological potential of the mound, on scale 1 pristine - 5 extinct mound</desc>
        <opts>
          <opt>
            0 - No observation
          </opt>
          <opt>
            1 - pristine (only superficial or minor damage)
          </opt>
          <opt>
            2 - partially damaged
          </opt>
          <opt>
            3 - damaged (up to 50% volume missing or archaeological potential compromised)
          </opt>
          <opt>
            4 - seriously damaged ( archaeological potential seriously compromised)
          </opt>
          <opt>
            5 - near extinct
          </opt>
        </opts>
      </Condition>
      <Source_of_Impact t="dropdown">
        <opts>
          <opt>
            Not available
          </opt>
          <opt>
            Agriculture
          </opt>
          <opt>
            Looting
          </opt>
          <opt>
            Infrastructure (road on or next to mound)
          </opt>
          <opt>
            Development (city growth, road building)
          </opt>
          <opt>
            Other (specify in an annotation, please)
          </opt>
        </opts>
      </Source_of_Impact>
      <Robbers_trenches t="checkbox">
        Robber's trenches?
        <opts>
          <opt>
            Random
          </opt>
          <opt>
            Rectilinear
          </opt>
          <opt>
            Variable shapes
          </opt>
          <opt>
            None present
          </opt>
          <opt>
            Other (specify in annotation)
          </opt>
        </opts>
      </Robbers_trenches>
      <Notes_on_Condition>
        <desc>Take a detailed picture of any interesting phenomena on the mound (e.g. Robber's trenches or associated cultural material)</desc>
      </Notes_on_Condition>
      <Detail_photo t="camera"/>
      <Associated_material t="checkbox">
        <desc>Document material you found on the mound, use annotation and Detail photo (with scale) for additional info.</desc>
        <opts>
          <opt>
            Fineware pottery
          </opt>
          <opt>
            Coarseware pottery
          </opt>
          <opt>
            Flaked lithic
          </opt>
          <opt>
            Ground lithic
          </opt>
          <opt>
            Architectural ceramics or building materials
          </opt>
          <opt>
            Construction stone
          </opt>
          <opt>
            Other
          </opt>
        </opts>
      </Associated_material>
      <Associated_features>
        <desc>Describe any standing features directly associated with the mound, such as a krepis, enclosure wall, later constructions, etc. List dimensions with each feature or document with images.</desc>
      </Associated_features>
    </Condition>
  </Mound>
  <logic><![CDATA[
/****************************** GIS POINT STYLES ******************************/
final String MAP_REF = "Control/Map/Map";

/* Displays the geometry of each entity whose menu, by the name of `attribName`,
 * has `vocabName` saved in it. The geometry is displayed in whatever colour is
 * given by `geoColor`.
 *
 * The geometry is displayed in a layer called `layerName`. This is a
 * human-readable name that the user can use to toggle the visibility of the
 * geometry in the UI.
 */
void showDatabaseLayerByVocabName(
    String attribName,
    String vocabName,
    int    geoColor, /* Example argument: Color.BLACK */
    String layerName
) {
  int transBlk = Color.parseColor("#AA000000");
  GeometryStyle sln_ = createLineStyle(10, transBlk, 0.01f, 0.3f, null);

  // Define arguments to `showDatabaseLayer`
  String q;
  q  = "SELECT uuid, aenttimestamp";
  q += "  FROM latestNonDeletedArchEnt";
  q += "  JOIN latestnondeletedaentvalue USING (uuid)";
  q += "  JOIN attributekey              USING (attributeid)";
  q += "  JOIN vocabulary                USING (vocabid)";
  q += " WHERE {vocabName}  IN ('', vocabname)";
  q += "   AND {attribName} IN ('', attributename)";
  q  = dbReplaceFirst(q, "{vocabName}",  vocabName);
  q  = dbReplaceFirst(q, "{attribName}", attribName);

  boolean isEntity = true;
  GeometryStyle spt = createPointStyle(10, geoColor, 0.2f, 0.5f);
  GeometryStyle sln = createLineStyle(10, geoColor, 0.05f, 0.3f, null);
  GeometryStyle spg = createPolygonStyle(10, geoColor, sln_);
  GeometryTextStyle stx = createTextStyle(
      10,
      Color.BLACK,
      40,
      Typeface.SANS_SERIF
  );

  showDatabaseLayer(
      MAP_REF,
      layerName,
      isEntity,
      layerName,
      q,
      spt,
      sln,
      spg,
      stx
  );
}

void showDatabaseLayerByVocabName(
    String vocabName,
    int    geoColor,
    String layerName
) {
  showDatabaseLayerByVocabName("", vocabName, geoColor, layerName);
}

void showDatabaseLayerByVocabName(String vocabName, int geoColor) {
  String layerName = guessArch16nValFromKey(vocabName);
  showDatabaseLayerByVocabName(vocabName, geoColor, layerName);
}

void initMap() {
  // showBaseMap(MAP_REF, "Base Map", "files/data/R1980_YambolElhovoExt.tif");

  showDatabaseLayerByVocabName("{0___No_observation}", Color.BLUE);
  showDatabaseLayerByVocabName("{1___pristine__only_superficial_or_minor_damage_}", Color.CYAN);
  showDatabaseLayerByVocabName("{2___partially_damaged}", Color.GREEN);
  showDatabaseLayerByVocabName("{3___damaged__up_to_50__volume_missing_or_archaeological_potential_compromised_}", Color.MAGENTA);
  showDatabaseLayerByVocabName("{4___seriously_damaged___archaeological_potential_seriously_compromised_}", Color.RED);
  showDatabaseLayerByVocabName("{5___near_extinct}", Color.YELLOW);

  setMapZoom(MAP_REF, 13.0f);
}

initMap();

  ]]></logic>
</module>
